document: title: "Additional Definition Document (Migration Due to Environmental Changes)" version: "1.0" sections: - number: 1 heading: "Background & Purpose" content: | Our development has primarily used **Supabase Auth + Netlify + Supabase (PostgreSQL)**, but now we are transitioning to **Next.js + Vercel + Neon + NextAuth.js**. This document aims to clarify which features have been implemented and which remain unimplemented, identifying areas needing changes due to the migration. The goal is to ensure a smooth transition for continued development using cursorAI. - number: 2 heading: "New Environment" content: | 1. Frontend & Serverless API: Next.js (deployed on Vercel) 2. Database: Neon (PostgreSQL) 3. Authentication: NextAuth.js (Google OAuth) 4. Hosting: Vercel - Scheduled imports are planned to use Vercel's Cron Jobs 5. Others: - Google Sheets API integration (spreadsheet import) - Google Calendar API integration (calendar export) - number: 3 heading: "Currently Implemented Features & Screens" content: | 3.1 Calendar Features - Toggle display between personal and all-team calendars - UI elements such as tabs and toggle buttons have been implemented. - Display functions for schedules, work hours, and tasks on the calendar have been tested using a dummy database. - Modal display upon clicking date cell - Implemented transitions to new forms or modals for adding events, tasks, or clock-in records. - Inputs use dummy data structures for testing.

`3.2 Task Management - Task list screen - Can filter tasks by status (open/done). - The layout for the task addition form (task name, assignee, deadline, etc.) is complete. - Backend integration is partial (DB connection pending). 3.3 Project Management - Project list/details screen - UI for creating new projects (name, tags, description) is complete. - UI for registering team members is in prototype state (DB integration pending). 3.4 Admin Screen - Routing exclusive to administrators is prepared. - Manual button for spreadsheet import: - UI button placement and click event handlers are implemented (originally for Netlify Functions/Supabase). 3.5 Authentication Features - Provisional login using Supabase Auth + Google OAuth. - User profile management and role retrieval (admin/member) were planned using Supabase tables. 3.6 Google Calendar Export - Frontend link button and provisional Netlify Function for Google Calendar API calls exists. - Linking with Supabase for schedule data retrieval was planned but not completed. - number: 4 heading: "Points Needing Changes for the New Environment" content: | 1. Authentication: Supabase Auth → NextAuth.js - Currently using Google OAuth via Supabase Auth. - Switching to NextAuth.js requires creating /api/auth/[...nextauth].ts and resetting Google client information. - Revise logic for retrieving user information (roles, email, etc.). 2. Database Connection: Supabase (PostgreSQL) → Neon (PostgreSQL) - Change connection endpoints and authentication keys to those for Neon. - Remove Supabase libraries and consider other query methods like Prisma. 3. Hosting: Netlify → Vercel - Change auto-deployment/CI settings from Netlify to Vercel. - Migrate scheduled tasks from Netlify's Scheduled Functions to Vercel Cron Jobs. - Reconfigure API endpoints to align with Next.js API Routes. 4. Sheet Import System - Replace logic implemented in Netlify Functions with Vercel Cron + Next.js API Routes. - Reset the API credentials and sheet IDs for Google Sheets API in Vercel. 5. Google Calendar Export - Migrate from a Netlify Functions setup to Next.js API Routes. - Reset environmental variables (Google API Credentials) in Vercel's management interface. - Re-implement access token management, error handling, and deduplication processes for repeated exports. - number: 5 heading: "Unimplemented/Additional Implementation Required" content: | 1. DB Schema and CRUD Implementation: - Currently testing UI with dummy tables. - Require design and implementation of production tables in Neon. 2. Authentication and Permission Management: - After introducing NextAuth, methods for distinguishing roles: admin/member are undecided. - Need to organize JWT custom claims or flow for retrieving from the database. 3. Spreadsheet Import (Scheduled) - Endpoint for daily invocation at midnight via Vercel Cron not yet implemented. - Need to reset Google Sheets API credentials and sheet IDs. 4. Google Calendar Export - UI button is only provisionally implemented; API integration and authentication token management are incomplete. - Error handling and deduplication measures are unaddressed. 5. Admin Screen Features - UI for member list/add/edit exists, but DB writing is pending. - Project management screens are only UI with mock data; formal DB integration pending. 6. Testing/Validation - E2E and unit testing are not yet commenced. - Validation for dates and clock-ins is insufficient. - number: 6 heading: "Priority of Future Tasks (Example)" content: | 1. Transition to NextAuth.js - Prepare authentication settings, Google OAuth credentials, and role management systems. 2. DB Connection to Neon and Finalize Table Design - Confirm and migrate base tables (users/calendar events/tasks/projects, etc.). 3. Cron Job (Spreadsheet Import) - Reflect API Routes on scheduled daily Vercel Cron, and manual button linkage with Next.js API Routes. 4. Google Calendar Export - Create/update calendars per user. Assess authentication token management. 5. Finalize Admin Screen Implementations - Complete CRUD and permission controls for member and project management. 6. Link Task and Attendance Management with DB - Write/read connections between frontend UI, API, and Neon. 7. Establish Testing, Validation, Finishing Touches - Introduce unit tests/E2E tests. Strengthen validation for attendance and schedule inputs. - number: 7 heading: "Future Extension Plans (Reiteration)" content: | - Weekly Report Management: Add a weekly report page by project. - Responsive Design: Optimize for mobile and tablets. - Notification Features: Task deadline alerts, missed attendance notifications. - Expand Calendar Display: Toggle between month/week/day views, enable drag & drop. - number: 8 heading: "Assumed Handover Flow for Development" content: | 1. Repository Migration - Initiate migration by creating a branch for Next.js (Vercel) from the existing Netlify/Supabase code. 2. Adjust Configuration Files for Authentication, DB, and Hosting - Modify .env and set Vercel's environment variables. - Adjust /api/auth/[...nextauth].ts and next.config.js for NextAuth.js. 3. Progress Sharing with cursorAI - Present this document, explaining source code/UI status. - Also share demo environment and local startup procedures. 4. Migration Work & Testing - Test actual functionality on Vercel, make corrections, and test deployment. 5. Additional Development - Sequentially address unimplemented parts (DB linkage, Cron, Google Calendar API, etc.). - number: 9 heading: "Conclusion" content: | This document organizes "current development status," "responses for migration to a new environment," and "unimplemented features." Priority will be given to addressing major changes in authentication, DB, hosting, and API routes, ensuring smooth handover to cursorAI. - Completed parts: Some UI, modals, sections of task management, admin screen templates - Essential changes due to environment migration: Authentication (NextAuth.js), DB (Neon), Hosting (Vercel) - Unimplemented: DB CRUD, scheduled imports (Vercel Cron), full implementation of Google Calendar export, testing, and validation, etc.`
